{% extends 'base.html.twig' %}

{% block title %}Détail commande {{ commande.reference }}{% endblock %}

{% block body %}
<link rel="stylesheet" href="{{ asset('CSS/Admin.css') }}">

<div class="container mt-4">
    <h1>Détail de la commande n°{{ commande.reference }}</h1>

    {# Infos supplémentaires visibles uniquement pour ADMIN #}
    {% if isAdmin %}
        <p><strong>Utilisateur :</strong> 
            {{ commande.utilisateur ? commande.utilisateur.prenom ~ ' ' ~ commande.utilisateur.nom : 'Inconnu' }}
            ({{ commande.utilisateur ? commande.utilisateur.email : '' }})
        </p>

        <p><strong>Adresse de livraison :</strong>
            {% if commande.utilisateur %}
                {{ commande.utilisateur.adresse }},
                {{ commande.utilisateur.cp }} {{ commande.utilisateur.ville }}
            {% else %}
                Non renseignée
            {% endif %}
        </p>
    {% else %}
        {# Version utilisateur simple #}
        <p><strong>Référence :</strong> {{ commande.reference }}</p>
        <p><strong>Utilisateur :</strong> {{ commande.utilisateur ? commande.utilisateur.email : '' }}</p>
    {% endif %}

    <h2>Produits commandés</h2>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Produit</th>
                <th>Quantité</th>
                <th>Prix unitaire (€)</th>
                <th>Sous-total (€)</th>
            </tr>
        </thead>
        <tbody>
            {% set total = 0 %}
            {% for ligne in commande.ligneDeCommandes %}
                {% set sousTotal = ligne.quantiteCommande * ligne.prixUnitaireProduit %}
                {% set total = total + sousTotal %}

                <tr>
                    <td>{{ ligne.produit ? ligne.produit.nomProduit : 'Produit supprimé' }}</td>
                    <td>{{ ligne.quantiteCommande }}</td>
                    <td>{{ ligne.prixUnitaireProduit }}</td>
                    <td>{{ sousTotal }}</td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4" class="text-center">Aucun produit dans cette commande</td>
                </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" class="text-end">Total :</th>
                <th>{{ total }} €</th>
            </tr>
        </tfoot>
    </table>

    {# Bouton retour uniquement pour ADMIN #}
    {% if is_granted('ROLE_ADMIN') %}
        <div class="Retour">
            <a href="{{ path('Compte_AdministrateurHistoriquesCommandesUtilisateurs') }}" class="btn btn-secondary">Retour à la liste</a>
        </div>
     {% elseif is_granted('ROLE_USER') %}
     <div class="Retour">
            <a href="{{ path('Compte_Espace') }}" class="btn btn-secondary">Revenir dans mon compte</a>
        </div>
    {% endif %}
</div>
{% endblock %}
