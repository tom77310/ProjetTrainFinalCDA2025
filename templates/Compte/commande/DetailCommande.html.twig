{% extends 'base.html.twig' %}

{% block title %}Détail commande {{ commande.reference }}{% endblock %}

{% block body %}
<link rel="stylesheet" href="{{ asset('CSS/Commandes.css') }}">
    <h1 class="DetailCommandeTitre">Détail de la commande n°{{ commande.reference }}</h1>

<div class="DetailCommandeContainer">

    {% if isAdmin %}
        <p class="DetailInfo"><strong>Utilisateur :</strong> 
            {{ commande.utilisateur ? commande.utilisateur.prenom ~ ' ' ~ commande.utilisateur.nom : 'Inconnu' }}
            ({{ commande.utilisateur ? commande.utilisateur.email : '' }})
        </p>

        <p class="DetailInfo"><strong>Adresse de livraison :</strong>
            {% if commande.utilisateur %}
                {{ commande.utilisateur.adresse }},
                {{ commande.utilisateur.cp }} {{ commande.utilisateur.ville }}
            {% else %}
                Non renseignée
            {% endif %}
        </p>
    {% else %}
        <p class="DetailInfo"><strong>Référence :</strong> {{ commande.reference }}</p>
        <p class="DetailInfo"><strong>Utilisateur :</strong> {{ commande.utilisateur ? commande.utilisateur.email : '' }}</p>
    {% endif %}

    <h2 class="DetailCommandeSousTitre">Produits commandés</h2>
   <table class="DetailCommandeTable">
    <thead>
        <tr>
            <th>Produit</th>
            <th>Quantité</th>
            <th>Prix unitaire (€)</th>
            <th>Sous-total (€)</th>
        </tr>
    </thead>
    <tbody>
        {% set total = 0 %}
        {% for ligne in commande.ligneDeCommandes %}
            {% set sousTotal = ligne.quantiteCommande * ligne.prixUnitaireProduit %}
            {% set total = total + sousTotal %}
            <tr>
                <td>
                    <span class="label">Produit :</span>
                    <span class="valeur">{{ ligne.produit ? ligne.produit.nomProduit : 'Produit supprimé' }}</span>
                </td>
                <td>
                    <span class="label">Quantité :</span>
                    <span class="valeur">{{ ligne.quantiteCommande }}</span>
                </td>
                <td>
                    <span class="label">Prix Unitaire :</span>
                    <span class="valeur">{{ ligne.prixUnitaireProduit }} €</span>
                </td>
                <td>
                    <span class="label">Sous-total :</span>
                    <span class="valeur">{{ sousTotal }} €</span>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="4" class="AucunProduit">Aucun produit dans cette commande</td>
            </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <th colspan="3" class="TotalLabel">Total de la commande :</th>
            <th class="TotalValeur">{{ total }} €</th>
        </tr>
    </tfoot>
</table>

    <div class="Retour">
        {% if is_granted('ROLE_ADMIN') %}
            <a href="{{ path('Compte_AdministrateurHistoriquesCommandesUtilisateurs') }}" class="BoutonRetour">Retour à la liste</a>
        {% elseif is_granted('ROLE_USER') %}
            <a href="{{ path('Compte_UtilisateurHistoriqueCommande') }}" class="BoutonRetour">Historique de commande</a>
        {% endif %}
    </div>
</div>
{% endblock %}
