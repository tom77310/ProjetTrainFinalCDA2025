{% extends 'base.html.twig' %}

{% block body %}
   <link rel="stylesheet" href="{{ asset('CSS/Commandes.css') }}">
 <title>{% block title %}Mes commandes{% endblock %}</title>
   
{% include 'partials/_navCompte.html.twig' %}
   
   {% if is_granted('ROLE_ADMIN') %}
    <h1 class="HistoriqueCommandeTitre">Historique des commandes des Utilisateurs</h1>
{% elseif is_granted('ROLE_USER') %}
    <h1 class="HistoriqueCommandeTitre">Mon Historique de Commandes</h1>
{% endif %}


  <div class="HistoriqueDeCommandes">
    <table class="ListeCommandes">
        <thead>
            <tr>
                <th>Référence</th>
                {% if is_granted('ROLE_ADMIN') %}
                    <th>Utilisateurs</th>
                {% else %}
                    <th>Email</th>
                {% endif %}
                <th>Adresse de livraison</th>
                <th>Nombre total d'articles</th>
                <th>Total (€)</th>
                <th>Détail</th>
            </tr>
        </thead>
        <tbody>
            {% if commandes is empty %}
                <tr class="CommandesVide">
                    <td colspan="6">
                        {% if is_granted('ROLE_ADMIN') %}
                            Aucune commande à afficher.
                        {% else %}
                            Vous n'avez aucune commande.
                        {% endif %}
                    </td>
                </tr>
            {% else %}
                {% for commande in commandes %}
                    {% set total = 0 %}
                    {% set nbArticles = 0 %}
                    {% for ligne in commande.ligneDeCommandes %}
                        {% set total = total + (ligne.quantiteCommande * ligne.prixUnitaireProduit) %}
                        {% set nbArticles = nbArticles + ligne.quantiteCommande %}
                    {% endfor %}

                    <tr>
                        <td>{{ commande.reference }}</td>
                        {% if is_granted('ROLE_ADMIN') %}
                            <td>{{ commande.utilisateur ? commande.utilisateur.nom ~ ' ' ~ commande.utilisateur.prenom : 'Inconnu' }}</td>
                        {% else %}
                            <td>{{ commande.utilisateur ? commande.utilisateur.email : 'Inconnu' }}</td>
                        {% endif %}
                        <td>
                            {% if commande.utilisateur %}
                                {{ commande.utilisateur.adresse }},
                                {{ commande.utilisateur.cp }} {{ commande.utilisateur.ville }}
                            {% else %}
                                Non renseignée
                            {% endif %}
                        </td>
                        <td>{{ nbArticles }}</td>
                        <td>{{ total }}</td>
                        <td class="BouttonVoir">
                         {% if is_granted('ROLE_ADMIN') %}
                            <a href="{{ path('Compte_AdministrateurDetailCommande', {id: commande.id}) }}">Voir</a>
                            {% elseif is_granted('ROLE_USER') %}
                            <a href="{{ path('Compte_UtilisateurDetailCommande', {id: commande.id}) }}">Voir</a>
                             {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</div>

{% endblock %}