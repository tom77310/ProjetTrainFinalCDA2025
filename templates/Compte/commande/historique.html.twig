{% extends 'base.html.twig' %}

{% block body %}
   <link rel="stylesheet" href="{{ asset('CSS/Utilisateurs.css') }}">
   <link rel="stylesheet" href="{{ asset('CSS/Admin.css') }}">
 <title>{% block title %}Mes commandes{% endblock %}</title>
   
   
   {% if is_granted('ROLE_ADMIN') %}
    <h1>Historique des commandes des Utilisateurs</h1>
{% elseif is_granted('ROLE_USER') %}
    <h1>Mon Historique de Commandes</h1>
{% endif %}

{% if is_granted('ROLE_ADMIN') %}
<div class="Droite">
    <div class="ListeUtilisateurs">
        <a href={{ path('Administrateur_ListeUtilisateurs') }}>Liste des Utilisateurs</a>
    </div>
    <div class="ListeProduits">
        <a href={{ path('Administrateur_ListeProduits') }}>Liste des produits</a>
    </div>
    <div class="HistoriqueCommandes">
        <a href="#">Historique des Commandes des utilisateurs</a>
    </div>
    <div class="BoiteReception">
        <a href={{ path('Compte_BoiteReception') }}>Boite de Réception</a>
    </div>
</div>
{% elseif is_granted('ROLE_USER') %}
<div class="Droite">
    <div class="InfosPersos">
        <a href={{ path('Compte_infosPersos') }}>Mes Informations Personnelles</a>
    </div>
    <div class="Retractation">
        <a href={{ path('Compte_FormRetractation') }}>Formulaire de retour</a>
    </div>
    <div class="HistoriqueDeCommandes">
        <a href="#">Historique de vos Commandes</a>
    </div>
    <div class="BoiteReception">
        <a href={{ path('Compte_BoiteReception') }}>Boite de Réception</a>
    </div>
</div>
{% endif %}

  <div class="HistoriqueDeCommandes">
    <table class="ListeCommandes">
        <thead>
            <tr>
                <th>Référence</th>
                {% if is_granted('ROLE_ADMIN') %}
                    <th>Utilisateurs</th>
                {% else %}
                    <th>Email</th>
                {% endif %}
                <th>Adresse de livraison</th>
                <th>Nombre total d'articles</th>
                <th>Total (€)</th>
                <th>Détail</th>
            </tr>
        </thead>
        <tbody>
            {% if commandes is empty %}
                <tr class="CommandesVide">
                    <td colspan="6">
                        {% if is_granted('ROLE_ADMIN') %}
                            Aucune commande à afficher.
                        {% else %}
                            Vous n'avez aucune commande.
                        {% endif %}
                    </td>
                </tr>
            {% else %}
                {% for commande in commandes %}
                    {% set total = 0 %}
                    {% set nbArticles = 0 %}
                    {% for ligne in commande.ligneDeCommandes %}
                        {% set total = total + (ligne.quantiteCommande * ligne.prixUnitaireProduit) %}
                        {% set nbArticles = nbArticles + ligne.quantiteCommande %}
                    {% endfor %}

                    <tr>
                        <td>{{ commande.reference }}</td>
                        {% if is_granted('ROLE_ADMIN') %}
                            <td>{{ commande.utilisateur ? commande.utilisateur.nom ~ ' ' ~ commande.utilisateur.prenom : 'Inconnu' }}</td>
                        {% else %}
                            <td>{{ commande.utilisateur ? commande.utilisateur.email : 'Inconnu' }}</td>
                        {% endif %}
                        <td>
                            {% if commande.utilisateur %}
                                {{ commande.utilisateur.adresse }},
                                {{ commande.utilisateur.cp }} {{ commande.utilisateur.ville }}
                            {% else %}
                                Non renseignée
                            {% endif %}
                        </td>
                        <td>{{ nbArticles }}</td>
                        <td>{{ total }}</td>
                        <td class="BouttonVoir">
                         {% if is_granted('ROLE_ADMIN') %}
                            <a href="{{ path('Compte_AdministrateurDetailCommande', {id: commande.id}) }}">Voir (ADMIN)</a>
                            {% elseif is_granted('ROLE_USER') %}
                            <a href="{{ path('Compte_UtilisateurDetailCommande', {id: commande.id}) }}">Voir (USER)</a>
                             {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</div>

{% endblock %}